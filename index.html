<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Kernel Project</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* üåå –ü–µ—Ä–µ–ª–∏–≤–∞—é—â–∏–π—Å—è —Ñ–æ–Ω: —Ç—ë–º–Ω—ã–π —á—ë—Ä–Ω–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
    body {
      color:#fff; font-family: Inter, sans-serif;
      background: linear-gradient(-45deg,#0a0012,#150020,#1b002b,#000000);
      background-size: 400% 400%;
      animation: gradientMove 18s ease infinite;
    }
    @keyframes gradientMove {
      0% { background-position: 0% 50% }
      50% { background-position: 100% 50% }
      100% { background-position: 0% 50% }
    }

    /* UI —ç–ª–µ–º–µ–Ω—Ç—ã */
    .btn{padding:.6rem 1.1rem;border-radius:.7rem;font-weight:600;cursor:pointer;transition:.2s}
    .btn-primary{background:linear-gradient(90deg,#7e22ce,#4c1d95);color:#fff}
    .btn-primary:hover{opacity:.9}
    .btn-ghost{background:rgba(255,255,255,.08);color:#fff;border:1px solid rgba(255,255,255,.06)}
    .card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:1rem;box-shadow:0 6px 20px rgba(0,0,0,.5);padding:1rem}
    .input{width:100%;padding:.6rem .9rem;border-radius:.7rem;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);color:#fff}
    .label{font-size:.85rem;color:rgba(255,255,255,.7);margin-bottom:.3rem;display:block}

    header{background:rgba(15,15,25,.6);backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,.05)}
    .hero{text-align:center;padding:6rem 1rem;animation:fadeIn 1s ease forwards}
    .hero h1{font-size:3rem;font-weight:800;background:linear-gradient(90deg,#9333ea,#6b21a8,#4c1d95);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .price-old{text-decoration:line-through;opacity:.6;margin-right:.5rem}
    .price-new{color:#c084fc;font-weight:700}
    .badge{font-size:.7rem;background:#6b21a8;padding:.2rem .5rem;border-radius:.5rem;margin-left:.5rem}
  </style>
</head>
<body class="min-h-screen">

<header class="flex items-center justify-between px-6 py-4">
  <div class="flex items-center gap-2 text-xl font-bold">
    <span class="text-fuchsia-400">‚ö°</span>
    <span class="bg-gradient-to-r from-fuchsia-400 via-purple-400 to-indigo-400 bg-clip-text text-transparent">Kernel Project</span>
  </div>
  <div id="headerUser" class="opacity-80 text-sm">–ì–æ—Å—Ç—å</div>
</header>

<main id="app" class="max-w-6xl mx-auto p-6"></main>
<footer class="mt-16 text-center text-white/40 text-xs">Kernel Project ¬© 2025</footer>

<script>
/* ‚ö° –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API ‚Äî –∑–∞–º–µ–Ω–∏ —Å—Å—ã–ª–∫—É –Ω–∞ —Å–≤–æ–π backend (—Å /api –≤ –∫–æ–Ω—Ü–µ!) */
const API = "https://sajtept.onrender.com/api";

let token = localStorage.getItem("token");
let currentUser = null;

/* –ó–∞–ø—Ä–æ—Å—ã –∫ backend */
async function api(path, method="GET", data=null) {
  const res = await fetch(API+path, {
    method,
    headers: {
      "Content-Type": "application/json",
      ...(token? {Authorization: "Bearer "+token} : {})
    },
    body: data? JSON.stringify(data) : null
  });
  if (!res.ok) throw new Error((await res.json()).error || "–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞");
  return res.json();
}

/* –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω */
function renderHero() {
  document.getElementById("app").innerHTML = `
    <div class="hero">
      <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Kernel Project</h1>
      <button class="btn btn-primary mt-8" onclick="renderAuth()">Get Started</button>
    </div>`;
}

/* –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è / —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è */
function renderAuth() {
  document.getElementById("app").innerHTML = `
  <div class="grid md:grid-cols-2 gap-8 mt-12">
    <div class="card">
      <h2 class="text-xl font-bold mb-4 text-fuchsia-400">–í—Ö–æ–¥</h2>
      <label class="label">E-mail</label><input class="input mb-3" id="login_email"/>
      <label class="label">–ü–∞—Ä–æ–ª—å</label><input class="input mb-4" id="login_password" type="password"/>
      <button class="btn btn-primary w-full" onclick="login()">–í–æ–π—Ç–∏</button>
    </div>
    <div class="card">
      <h2 class="text-xl font-bold mb-4 text-indigo-400">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
      <label class="label">E-mail</label><input class="input mb-3" id="reg_email"/>
      <label class="label">–ò–º—è</label><input class="input mb-3" id="reg_name"/>
      <label class="label">–ü–∞—Ä–æ–ª—å</label><input class="input mb-4" id="reg_password" type="password"/>
      <button class="btn btn-primary w-full" onclick="register()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
    </div>
  </div>`;
}

async function login() {
  try {
    const email=document.getElementById("login_email").value.trim();
    const password=document.getElementById("login_password").value.trim();
    const res=await api("/login","POST",{email,password});
    token=res.token; localStorage.setItem("token",token); currentUser=res.user;
    renderApp();
  } catch(e){alert(e.message);}
}

async function register() {
  try {
    const email=document.getElementById("reg_email").value.trim();
    const displayName=document.getElementById("reg_name").value.trim();
    const password=document.getElementById("reg_password").value.trim();
    await api("/register","POST",{email,password,displayName});
    alert("–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ");
    renderAuth();
  } catch(e){alert(e.message);}
}

/* –ú–∞–≥–∞–∑–∏–Ω */
async function renderApp() {
  document.getElementById("headerUser").textContent=currentUser? currentUser.email : "–ì–æ—Å—Ç—å";
  const prods=await api("/products");
  let html=`
    <div class="flex gap-4 mb-8">
      <button class="btn btn-ghost" onclick="logout()">–í—ã–π—Ç–∏</button>
    </div>
    <h2 class="text-xl font-semibold mb-3">–ú–∞–≥–∞–∑–∏–Ω</h2>
    <div class="grid sm:grid-cols-2 md:grid-cols-3 gap-4">`;
  for (let p of prods){
    html+=`
      <div class="card">
        <div class="flex justify-between mb-2">
          <div class="font-semibold">${p.title}</div>
          ${p.pinned?'<span class="badge">–ó–∞–∫—Ä–µ–ø</span>':""}
        </div>
        <div class="text-sm text-white/70">${p.description||""}</div>
        <div class="mt-2">${p.discount>0? `<span class="price-old">${p.price}‚ÇΩ</span><span class="price-new">${Math.round(p.price*(1-p.discount/100))}‚ÇΩ (-${p.discount}%)</span>`:`<span class="price-new">${p.price}‚ÇΩ</span>`}</div>
        <div class="mt-3 flex gap-2">
          ${p.funpay_url? `<a class="btn btn-primary text-sm" href="${p.funpay_url}" target="_blank">–ö—É–ø–∏—Ç—å (FunPay)</a>`:""}
          ${p.star_url? `<a class="btn btn-primary text-sm" href="${p.star_url}" target="_blank">–ö—É–ø–∏—Ç—å (–ó–≤—ë–∑–¥—ã)</a>`:""}
          ${p.file_url? `<a class="btn btn-primary text-sm" href="${p.file_url}" target="_blank">–°–∫–∞—á–∞—Ç—å</a>`:""}
        </div>
      </div>`;
  }
  html+="</div>";
  document.getElementById("app").innerHTML=html;
}

function logout(){token=null;localStorage.removeItem("token");currentUser=null;renderHero();}
renderHero();
</script>
</body>
</html>
