<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Kernel Project</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      color:#fff; font-family: Inter, sans-serif;
      background: linear-gradient(-45deg,#050006,#0d0014,#1a0b2a,#0a0010);
      background-size:400% 400%;
      animation: gradientMove 20s ease infinite;
    }
    @keyframes gradientMove {
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    .btn{padding:.6rem 1.1rem;border-radius:.7rem;font-weight:600;cursor:pointer;transition:.2s}
    .btn-primary{background:linear-gradient(90deg,#9333ea,#4f46e5);color:#fff}
    .btn-primary:hover{opacity:.9}
    .btn-ghost{background:rgba(255,255,255,.08);color:#fff;border:1px solid rgba(255,255,255,.06)}
    .card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);border-radius:1rem;box-shadow:0 6px 20px rgba(0,0,0,.4);padding:1rem}
    .input{width:100%;padding:.6rem .9rem;border-radius:.7rem;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.08);color:#fff}
    .label{font-size:.85rem;color:rgba(255,255,255,.7);margin-bottom:.3rem;display:block}
    header{background:rgba(15,15,25,.5);backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,.05)}
    .hero{text-align:center;padding:6rem 1rem;animation:fadeIn 1s ease forwards}
    .hero h1{font-size:3rem;font-weight:800;background:linear-gradient(90deg,#9333ea,#4f46e5,#06b6d4);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .price-old{text-decoration:line-through;opacity:.6;margin-right:.5rem}
    .price-new{color:#c084fc;font-weight:700}
    .badge{font-size:.7rem;background:#9333ea;padding:.2rem .5rem;border-radius:.5rem;margin-left:.5rem}
  </style>
</head>
<body class="min-h-screen">

<header class="flex items-center justify-between px-6 py-4">
  <div class="flex items-center gap-2 text-xl font-bold">
    <span class="text-fuchsia-400">⚡</span>
    <span class="bg-gradient-to-r from-fuchsia-400 via-purple-400 to-indigo-400 bg-clip-text text-transparent">Kernel Project</span>
  </div>
  <div id="headerUser" class="opacity-80 text-sm">Гость</div>
</header>

<main id="app" class="max-w-6xl mx-auto p-6"></main>
<footer class="mt-16 text-center text-white/40 text-xs">Kernel Project © 2025</footer>

<script>
const API = "https://your-backend.onrender.com/api"; // ⚡ заменишь на свой backend Render
let token = localStorage.getItem("token");
let currentUser = null;

async function api(path, method="GET", data=null) {
  const res = await fetch(API+path, {
    method,
    headers: {
      "Content-Type": "application/json",
      ...(token? {Authorization: "Bearer "+token} : {})
    },
    body: data? JSON.stringify(data) : null
  });
  if (!res.ok) throw new Error((await res.json()).error || "Ошибка запроса");
  return res.json();
}

// --- Hero ---
function renderHero() {
  document.getElementById("app").innerHTML = `
    <div class="hero">
      <h1>Добро пожаловать в Kernel Project</h1>
      <button class="btn btn-primary mt-8" onclick="renderAuth()">Get Started</button>
    </div>`;
}

// --- Auth ---
function renderAuth() {
  document.getElementById("app").innerHTML = `
  <div class="grid md:grid-cols-2 gap-8 mt-12">
    <div class="card">
      <h2 class="text-xl font-bold mb-4 text-fuchsia-400">Вход</h2>
      <label class="label">E-mail</label><input class="input mb-3" id="login_email"/>
      <label class="label">Пароль</label><input class="input mb-4" id="login_password" type="password"/>
      <button class="btn btn-primary w-full" onclick="login()">Войти</button>
    </div>
    <div class="card">
      <h2 class="text-xl font-bold mb-4 text-indigo-400">Регистрация</h2>
      <label class="label">E-mail</label><input class="input mb-3" id="reg_email"/>
      <label class="label">Имя</label><input class="input mb-3" id="reg_name"/>
      <label class="label">Пароль</label><input class="input mb-4" id="reg_password" type="password"/>
      <button class="btn btn-primary w-full" onclick="register()">Создать аккаунт</button>
    </div>
  </div>`;
}

async function login() {
  try {
    const email=document.getElementById("login_email").value.trim();
    const password=document.getElementById("login_password").value.trim();
    const res=await api("/login","POST",{email,password});
    token=res.token; localStorage.setItem("token",token); currentUser=res.user;
    renderApp();
  } catch(e){alert(e.message);}
}

async function register() {
  try {
    const email=document.getElementById("reg_email").value.trim();
    const displayName=document.getElementById("reg_name").value.trim();
    const password=document.getElementById("reg_password").value.trim();
    await api("/register","POST",{email,password,displayName});
    alert("Аккаунт создан! Теперь войдите");
    renderAuth();
  } catch(e){alert(e.message);}
}

// --- Profile ---
function renderProfile() {
  document.getElementById("app").innerHTML = `
    <div class="card max-w-md mx-auto">
      <h2 class="text-xl font-bold mb-4 text-fuchsia-400">Профиль</h2>
      <p class="mb-4">Вы вошли как <b>${currentUser.displayName||currentUser.email}</b></p>
      <label class="label">Текущий пароль</label>
      <input class="input mb-3" id="old_pass" type="password"/>
      <label class="label">Новый пароль</label>
      <input class="input mb-3" id="new_pass" type="password"/>
      <label class="label">Подтверждение нового пароля</label>
      <input class="input mb-4" id="new_pass2" type="password"/>
      <button class="btn btn-primary w-full mb-2" onclick="changePassword()">Сменить пароль</button>
      <button class="btn btn-ghost w-full" onclick="renderApp()">Назад</button>
    </div>`;
}

async function changePassword() {
  alert("Смена пароля реализуется на backend (нужен эндпоинт /api/change-password).");
}

// --- Shop ---
async function renderApp() {
  document.getElementById("headerUser").textContent=currentUser? currentUser.email : "Гость";
  const prods=await api("/products");
  let html=`
    <div class="flex gap-4 mb-8">
      <button class="btn btn-ghost" onclick="logout()">Выйти</button>
      <button class="btn btn-ghost" onclick="renderProfile()">Профиль</button>
      ${currentUser.role==="admin" ? `<button class="btn btn-ghost" onclick="renderAdmin()">Админ-панель</button>`:""}
    </div>
    <h2 class="text-xl font-semibold mb-3">Магазин</h2>
    <div class="grid sm:grid-cols-2 md:grid-cols-3 gap-4">`;
  for (let p of prods){
    html+=`
      <div class="card">
        <div class="flex justify-between mb-2">
          <div class="font-semibold">${p.title}</div>
          ${p.pinned?'<span class="badge">Закреп</span>':""}
        </div>
        <div class="text-sm text-white/70">${p.description||""}</div>
        <div class="mt-2">${p.discount>0? `<span class="price-old">${p.price}₽</span><span class="price-new">${Math.round(p.price*(1-p.discount/100))}₽ (-${p.discount}%)</span>`:`<span class="price-new">${p.price}₽</span>`}</div>
        ${p.type==="download"
          ? `<a href="${p.file_url}" target="_blank" class="btn btn-primary mt-4">Скачать</a>`
          : `<div class="flex gap-2 mt-4"><a href="${p.funpay_url}" target="_blank" class="btn btn-primary flex-1">Купить (FunPay)</a><a href="${p.star_url}" target="_blank" class="btn btn-primary flex-1">Купить (Звёзды)</a></div>`}
      </div>`;
  }
  html+="</div>";
  document.getElementById("app").innerHTML=html;
}

// --- Admin panel ---
function renderAdmin() {
  document.getElementById("app").innerHTML=`
    <div class="card">
      <h2 class="text-xl font-bold mb-4">Админ-панель</h2>
      <label class="label">Название</label><input id="p_title" class="input mb-2"/>
      <label class="label">Цена</label><input id="p_price" class="input mb-2" type="number"/>
      <label class="label">Описание</label><textarea id="p_desc" class="input mb-2"></textarea>
      <label class="label">Скидка %</label><input id="p_discount" class="input mb-2" type="number"/>
      <label class="label">Закрепить</label><input id="p_pin" type="checkbox" class="mb-2"/>
      <label class="label">Тип товара</label>
      <select id="p_type" class="input mb-2"><option value="buy">Купить</option><option value="download">Скачать</option></select>
      <label class="label">Ссылка 1</label><input id="p_link1" class="input mb-2"/>
      <label class="label">Ссылка 2</label><input id="p_link2" class="input mb-2"/>
      <button class="btn btn-primary w-full mt-2" onclick="addProduct()">Добавить товар</button>
      <hr class="my-4"/>
      <label class="label">Назначить нового админа</label>
      <input id="new_admin" class="input mb-2"/>
      <button class="btn btn-primary w-full" onclick="makeAdmin()">Сделать админом</button>
      <button class="btn btn-ghost w-full mt-4" onclick="renderApp()">Назад</button>
    </div>`;
}

async function addProduct() {
  try{
    await api("/products","POST",{
      title:document.getElementById("p_title").value,
      description:document.getElementById("p_desc").value,
      price:parseInt(document.getElementById("p_price").value)||0,
      discount:parseInt(document.getElementById("p_discount").value)||0,
      pinned:document.getElementById("p_pin").checked,
      type:document.getElementById("p_type").value,
      fileUrl:document.getElementById("p_link1").value,
      funpayUrl:document.getElementById("p_link1").value,
      starUrl:document.getElementById("p_link2").value
    });
    alert("Товар добавлен!");
    renderApp();
  }catch(e){alert(e.message);}
}

async function makeAdmin() {
  try{
    const email=document.getElementById("new_admin").value.trim();
    await api("/make-admin","POST",{email});
    alert(email+" теперь админ!");
  }catch(e){alert(e.message);}
}

function logout(){token=null;localStorage.removeItem("token");currentUser=null;renderHero();}

renderHero();
</script>
</body>
</html>
